# 部署在线服务<a name="modelarts_04_0201"></a>

部署在线服务包括：

-   已部署为在线服务的初始化。
-   部署在线服务predictor。
-   部署批量服务transformer。

部署服务返回服务对象Predictor，其属性包括服务管理章节下的所有功能。

## 示例代码<a name="zh-cn_topic_0160619034_section20261580353"></a>

-   **方式1：已部署为在线服务predictor的初始化**

    ```
    from modelarts.session import Session
    from modelarts.model import Predictor
    session = Session()
    predictor_instance = Predictor(session, service_id="input your service_id")
    ```


-   **方式2：部署在线服务predictor**

    ```
    from modelarts.session import Session
    from modelarts.model import Model
    from modelarts.config.model_config import ServiceConfig,TransformerConfig 
    session = Session()
    model_instance = Model(session, model_id="input your model_id")
    predictor_instance = model_instance.deploy_predictor( 
                                                 service_name="input service predictor name",
                                                 infer_type="real-time",
                                                 vpc_id="vpc_id",
                                                 subnet_network_id="subnet_network_id ",
                                                 security_group_id="security_group_id",
                                                 configs=configs                # predictor配置参数, 参考下文configs参数格式说明)
    ```

    参数“model\_id“代表将部署成在线服务的模型。


-   <a name="zh-cn_topic_0160619034_li10567114011171"></a>**方式3：部署批量服务transformer**

    ```
    transformer = model_instance.deploy_transformer( 
                                                     service_name="input service transformer name",
                                                     infer_type="batch",
                                                     vpc_id="vpc_id",
                                                     subnet_network_id="subnet_network_id ",
                                                     security_group_id="security_group_id",
                                                     configs=configs            # transformer配置参数, 参考下文configs参数格式说明)
    ```


-   **关于部署在线服务predictor和批量服务transformer时，configs参数格式说明**
    -   部署在线服务predictor时：

        SDK提供了ServiceConfig类对其定义，configs为list，list中的元组对象是ServiceConfig.定义代码如下：

        ```
        configs = []
        service_config1 = ServiceConfig( 
                                         model_id="model_id1",
                                         weight="70",
                                         specification="specification",
                                         instance_count=2,
                                         envs=envs)
        service_config2 = ServiceConfig( 
                                         model_id="model_id2",
                                         weight="30",
                                         specification="specification",
                                         instance_count=2,
                                         envs=envs)
        configs.append(service_config1, service_config2)
        ```

    -   部署批量服务transformer时：

        SDK提供了TransformerConfig类对其定义，configs都是list，list中的元组对象是TransformerConfig.定义代码如下：

        ```
        configs = []
        transformer_config1 = TransformerConfig( 
                                                 model_id="model_id",
                                                 specification="specification",
                                                 instance_count=2,
                                                 src_path="src_path",
                                                 dest_path="dest_path",
                                                 req_uri="req_uri",
                                                 mapping_type="mapping_type",
                                                 mapping_rule="mapping_rule",
                                                 envs=envs)
        configs.append(transformer_config1)
        ```



## 参数说明<a name="zh-cn_topic_0160619034_section18683951918"></a>

**表 1**  参数说明

<a name="zh-cn_topic_0160619034_table16518993181628"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row41524868181628"><th class="cellrowborder" valign="top" width="15.1%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p30350749181639"><a name="zh-cn_topic_0160619034_p30350749181639"></a><a name="zh-cn_topic_0160619034_p30350749181639"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="9.75%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p42491604181639"><a name="zh-cn_topic_0160619034_p42491604181639"></a><a name="zh-cn_topic_0160619034_p42491604181639"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="13.170000000000002%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p19267891181639"><a name="zh-cn_topic_0160619034_p19267891181639"></a><a name="zh-cn_topic_0160619034_p19267891181639"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="61.980000000000004%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p17195363181639"><a name="zh-cn_topic_0160619034_p17195363181639"></a><a name="zh-cn_topic_0160619034_p17195363181639"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row6770181628"><td class="cellrowborder" valign="top" width="15.1%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p8780885181639"><a name="zh-cn_topic_0160619034_p8780885181639"></a><a name="zh-cn_topic_0160619034_p8780885181639"></a>service_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p40163046181639"><a name="zh-cn_topic_0160619034_p40163046181639"></a><a name="zh-cn_topic_0160619034_p40163046181639"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="13.170000000000002%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p31981288181639"><a name="zh-cn_topic_0160619034_p31981288181639"></a><a name="zh-cn_topic_0160619034_p31981288181639"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="61.980000000000004%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p40347522181639"><a name="zh-cn_topic_0160619034_p40347522181639"></a><a name="zh-cn_topic_0160619034_p40347522181639"></a>服务ID。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row399025208"><td class="cellrowborder" valign="top" width="15.1%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1992242017"><a name="zh-cn_topic_0160619034_p1992242017"></a><a name="zh-cn_topic_0160619034_p1992242017"></a>session</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p49910292012"><a name="zh-cn_topic_0160619034_p49910292012"></a><a name="zh-cn_topic_0160619034_p49910292012"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="13.170000000000002%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p69922102018"><a name="zh-cn_topic_0160619034_p69922102018"></a><a name="zh-cn_topic_0160619034_p69922102018"></a>Object</p>
</td>
<td class="cellrowborder" valign="top" width="61.980000000000004%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1689152543"><a name="zh-cn_topic_0160619034_p1689152543"></a><a name="zh-cn_topic_0160619034_p1689152543"></a>会话对象，初始化方法见<a href="Session鉴权概述.md">Session鉴权</a>。</p>
</td>
</tr>
</tbody>
</table>

**表 2**  部署在线服务predictor和transformer参数说明

<a name="zh-cn_topic_0160619034_table37462542238"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row57501354122312"><th class="cellrowborder" valign="top" width="15.340000000000002%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p14751165412319"><a name="zh-cn_topic_0160619034_p14751165412319"></a><a name="zh-cn_topic_0160619034_p14751165412319"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="9.75%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p575315411231"><a name="zh-cn_topic_0160619034_p575315411231"></a><a name="zh-cn_topic_0160619034_p575315411231"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="12.85%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p1275435419238"><a name="zh-cn_topic_0160619034_p1275435419238"></a><a name="zh-cn_topic_0160619034_p1275435419238"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="62.06%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p10756175492314"><a name="zh-cn_topic_0160619034_p10756175492314"></a><a name="zh-cn_topic_0160619034_p10756175492314"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row4758654192310"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p47591654132311"><a name="zh-cn_topic_0160619034_p47591654132311"></a><a name="zh-cn_topic_0160619034_p47591654132311"></a>service_name</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p17761854142313"><a name="zh-cn_topic_0160619034_p17761854142313"></a><a name="zh-cn_topic_0160619034_p17761854142313"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p8762155482314"><a name="zh-cn_topic_0160619034_p8762155482314"></a><a name="zh-cn_topic_0160619034_p8762155482314"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p15674133152710"><a name="zh-cn_topic_0160619034_p15674133152710"></a><a name="zh-cn_topic_0160619034_p15674133152710"></a>服务名称，支持1-48位可见字符（含中文），只能以英文大小写字母或者中文字符开头，名称可以包含字母、中文、数字、中划线、下划线。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row197641954112315"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p176625410236"><a name="zh-cn_topic_0160619034_p176625410236"></a><a name="zh-cn_topic_0160619034_p176625410236"></a>description</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p12768115419231"><a name="zh-cn_topic_0160619034_p12768115419231"></a><a name="zh-cn_topic_0160619034_p12768115419231"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p15770145472313"><a name="zh-cn_topic_0160619034_p15770145472313"></a><a name="zh-cn_topic_0160619034_p15770145472313"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p178591840172714"><a name="zh-cn_topic_0160619034_p178591840172714"></a><a name="zh-cn_topic_0160619034_p178591840172714"></a>服务备注，默认为空，不超过100个字符。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row8773165432319"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1477414540232"><a name="zh-cn_topic_0160619034_p1477414540232"></a><a name="zh-cn_topic_0160619034_p1477414540232"></a>infer_type</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1977655415234"><a name="zh-cn_topic_0160619034_p1977655415234"></a><a name="zh-cn_topic_0160619034_p1977655415234"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p12777135420239"><a name="zh-cn_topic_0160619034_p12777135420239"></a><a name="zh-cn_topic_0160619034_p12777135420239"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p11246114246"><a name="p11246114246"></a><a name="p11246114246"></a>推理方式，取值为real-time/batch/edge。</p>
<a name="ul1765415422419"></a><a name="ul1765415422419"></a><ul id="ul1765415422419"><li>real-time代表在线服务，将模型部署为一个Web Service，并且提供在线的测试UI与监控能力，服务一直保持运行。</li><li>batch为批量服务，批量服务可对批量数据进行推理，完成数据处理后自动停止。</li><li>edge表示边缘服务，通过华为云智能边缘平台，在边缘节点将模型部署为一个Web Service，需提前在IEF（智能边缘服务）创建好节点。</li></ul>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row13340112615168"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p23406263166"><a name="zh-cn_topic_0160619034_p23406263166"></a><a name="zh-cn_topic_0160619034_p23406263166"></a>vpc_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p934052616164"><a name="zh-cn_topic_0160619034_p934052616164"></a><a name="zh-cn_topic_0160619034_p934052616164"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p1340726101620"><a name="zh-cn_topic_0160619034_p1340726101620"></a><a name="zh-cn_topic_0160619034_p1340726101620"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p9565710261"><a name="p9565710261"></a><a name="p9565710261"></a>在线服务实例部署的虚拟私有云ID，默认为空，此时ModelArts会为每个用户分配一个专属的VPC，用户之间隔离；如需要在服务实例中访问名下VPC内的其他服务组件，则可配置此参数为对应VPC的ID。</p>
<p id="zh-cn_topic_0160619034_p23404269166"><a name="zh-cn_topic_0160619034_p23404269166"></a><a name="zh-cn_topic_0160619034_p23404269166"></a>VPC一旦配置，不支持修改。当vpc_id与cluster_id一同配置时，只有专属集群参数生效。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row957220334161"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p16572153315160"><a name="zh-cn_topic_0160619034_p16572153315160"></a><a name="zh-cn_topic_0160619034_p16572153315160"></a>subnet_network_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p3572163313168"><a name="zh-cn_topic_0160619034_p3572163313168"></a><a name="zh-cn_topic_0160619034_p3572163313168"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p5572143391611"><a name="zh-cn_topic_0160619034_p5572143391611"></a><a name="zh-cn_topic_0160619034_p5572143391611"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p2572933181610"><a name="zh-cn_topic_0160619034_p2572933181610"></a><a name="zh-cn_topic_0160619034_p2572933181610"></a>子网的网络ID，默认为空，当配置了vpc_id则此参数必填。需填写虚拟私有云控制台子网详情中显示的“网络ID”。通过子网可提供与其他网络隔离的、可以独享的网络资源。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row295516219164"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p8956132151619"><a name="zh-cn_topic_0160619034_p8956132151619"></a><a name="zh-cn_topic_0160619034_p8956132151619"></a>security_group_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p15956122161615"><a name="zh-cn_topic_0160619034_p15956122161615"></a><a name="zh-cn_topic_0160619034_p15956122161615"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p295632112162"><a name="zh-cn_topic_0160619034_p295632112162"></a><a name="zh-cn_topic_0160619034_p295632112162"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1595642161617"><a name="zh-cn_topic_0160619034_p1595642161617"></a><a name="zh-cn_topic_0160619034_p1595642161617"></a>安全组，默认为空，当配置了vpc_id则此参数必填。安全组起着虚拟防火墙的作用，为服务实例提供安全的网络访问控制策略。安全组须包含至少一条入方向规则，对协议为TCP、源地址为0.0.0.0/0、端口为8080的请求放行。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row1477965462320"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1678119545237"><a name="zh-cn_topic_0160619034_p1678119545237"></a><a name="zh-cn_topic_0160619034_p1678119545237"></a>configs</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p12784165413231"><a name="zh-cn_topic_0160619034_p12784165413231"></a><a name="zh-cn_topic_0160619034_p12784165413231"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p1378505482320"><a name="zh-cn_topic_0160619034_p1378505482320"></a><a name="zh-cn_topic_0160619034_p1378505482320"></a>包括predictor configs结构和transformer configs</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p171811636162510"><a name="p171811636162510"></a><a name="p171811636162510"></a>模型运行配置。</p>
<a name="ul4744163702515"></a><a name="ul4744163702515"></a><ul id="ul4744163702515"><li>当推理方式为batch/edge时仅支持配置一个模型。</li><li>当推理方式为real-time时，可根据业务需要配置多个模型并分配权重，但多个模型的版本号不能相同</li></ul>
</td>
</tr>
</tbody>
</table>

**表 3**  predictor configs结构

<a name="zh-cn_topic_0160619034_table6841887256"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row4846788252"><th class="cellrowborder" valign="top" width="11.742574257425742%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p884819812515"><a name="zh-cn_topic_0160619034_p884819812515"></a><a name="zh-cn_topic_0160619034_p884819812515"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="7.524752475247524%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p1985013812252"><a name="zh-cn_topic_0160619034_p1985013812252"></a><a name="zh-cn_topic_0160619034_p1985013812252"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="14.85148514851485%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p1852188192520"><a name="zh-cn_topic_0160619034_p1852188192520"></a><a name="zh-cn_topic_0160619034_p1852188192520"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="65.88118811881188%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p38538832514"><a name="zh-cn_topic_0160619034_p38538832514"></a><a name="zh-cn_topic_0160619034_p38538832514"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row1856380258"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1786010872513"><a name="zh-cn_topic_0160619034_p1786010872513"></a><a name="zh-cn_topic_0160619034_p1786010872513"></a>model_id</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p386268152512"><a name="zh-cn_topic_0160619034_p386268152512"></a><a name="zh-cn_topic_0160619034_p386268152512"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p1386419814252"><a name="zh-cn_topic_0160619034_p1386419814252"></a><a name="zh-cn_topic_0160619034_p1386419814252"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p9866118172511"><a name="zh-cn_topic_0160619034_p9866118172511"></a><a name="zh-cn_topic_0160619034_p9866118172511"></a>模型ID。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row1086798112511"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p986916812517"><a name="zh-cn_topic_0160619034_p986916812517"></a><a name="zh-cn_topic_0160619034_p986916812517"></a>weight</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p687111819259"><a name="zh-cn_topic_0160619034_p687111819259"></a><a name="zh-cn_topic_0160619034_p687111819259"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p138731787259"><a name="zh-cn_topic_0160619034_p138731787259"></a><a name="zh-cn_topic_0160619034_p138731787259"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p19875118162511"><a name="zh-cn_topic_0160619034_p19875118162511"></a><a name="zh-cn_topic_0160619034_p19875118162511"></a>权重百分比，分配到此模型的流量权重，仅当infer_type为real-time时需要配置，多个权重相加必须等于100；当在一个在线服务中同时配置了多个模型版本且设置不同的流量权重比例时，持续地访问此服务的预测接口，ModelArts会按此权重比例将预测请求转发到对应的模型版本实例。</p>
<p id="zh-cn_topic_0160619034_p152904326581"><a name="zh-cn_topic_0160619034_p152904326581"></a><a name="zh-cn_topic_0160619034_p152904326581"></a>{</p>
<p id="zh-cn_topic_0160619034_p4290732135814"><a name="zh-cn_topic_0160619034_p4290732135814"></a><a name="zh-cn_topic_0160619034_p4290732135814"></a>"service_name": "mnist",</p>
<p id="zh-cn_topic_0160619034_p2029063218588"><a name="zh-cn_topic_0160619034_p2029063218588"></a><a name="zh-cn_topic_0160619034_p2029063218588"></a>"description": "mnist service",</p>
<p id="zh-cn_topic_0160619034_p129012323585"><a name="zh-cn_topic_0160619034_p129012323585"></a><a name="zh-cn_topic_0160619034_p129012323585"></a>"infer_type": "real-time",</p>
<p id="zh-cn_topic_0160619034_p152900327589"><a name="zh-cn_topic_0160619034_p152900327589"></a><a name="zh-cn_topic_0160619034_p152900327589"></a>"config": [</p>
<p id="zh-cn_topic_0160619034_p1290183275817"><a name="zh-cn_topic_0160619034_p1290183275817"></a><a name="zh-cn_topic_0160619034_p1290183275817"></a>{</p>
<p id="zh-cn_topic_0160619034_p62901232155811"><a name="zh-cn_topic_0160619034_p62901232155811"></a><a name="zh-cn_topic_0160619034_p62901232155811"></a>"model_id": "xxxmodel-idxxx",</p>
<p id="zh-cn_topic_0160619034_p129023265814"><a name="zh-cn_topic_0160619034_p129023265814"></a><a name="zh-cn_topic_0160619034_p129023265814"></a>"weight": "70",</p>
<p id="zh-cn_topic_0160619034_p529023220583"><a name="zh-cn_topic_0160619034_p529023220583"></a><a name="zh-cn_topic_0160619034_p529023220583"></a>"specification": "modelarts.vm.cpu.2u",</p>
<p id="zh-cn_topic_0160619034_p1829013322587"><a name="zh-cn_topic_0160619034_p1829013322587"></a><a name="zh-cn_topic_0160619034_p1829013322587"></a>"instance_count": 1,</p>
<p id="zh-cn_topic_0160619034_p9290732135819"><a name="zh-cn_topic_0160619034_p9290732135819"></a><a name="zh-cn_topic_0160619034_p9290732135819"></a>"envs":</p>
<p id="zh-cn_topic_0160619034_p1529083214586"><a name="zh-cn_topic_0160619034_p1529083214586"></a><a name="zh-cn_topic_0160619034_p1529083214586"></a>{</p>
<p id="zh-cn_topic_0160619034_p1229020327589"><a name="zh-cn_topic_0160619034_p1229020327589"></a><a name="zh-cn_topic_0160619034_p1229020327589"></a>"model_name": "mxnet-model-1",</p>
<p id="zh-cn_topic_0160619034_p52901632175811"><a name="zh-cn_topic_0160619034_p52901632175811"></a><a name="zh-cn_topic_0160619034_p52901632175811"></a>"load_epoch": "0"</p>
<p id="zh-cn_topic_0160619034_p172905325580"><a name="zh-cn_topic_0160619034_p172905325580"></a><a name="zh-cn_topic_0160619034_p172905325580"></a>}</p>
<p id="zh-cn_topic_0160619034_p9290632205814"><a name="zh-cn_topic_0160619034_p9290632205814"></a><a name="zh-cn_topic_0160619034_p9290632205814"></a>},</p>
<p id="zh-cn_topic_0160619034_p72901232155811"><a name="zh-cn_topic_0160619034_p72901232155811"></a><a name="zh-cn_topic_0160619034_p72901232155811"></a>{</p>
<p id="zh-cn_topic_0160619034_p329043212580"><a name="zh-cn_topic_0160619034_p329043212580"></a><a name="zh-cn_topic_0160619034_p329043212580"></a>"model_id": "xxxxxx",</p>
<p id="zh-cn_topic_0160619034_p029053235817"><a name="zh-cn_topic_0160619034_p029053235817"></a><a name="zh-cn_topic_0160619034_p029053235817"></a>"weight": "30",</p>
<p id="zh-cn_topic_0160619034_p1829003216583"><a name="zh-cn_topic_0160619034_p1829003216583"></a><a name="zh-cn_topic_0160619034_p1829003216583"></a>"specification": "modelarts.vm.cpu.2u",</p>
<p id="zh-cn_topic_0160619034_p6290132135818"><a name="zh-cn_topic_0160619034_p6290132135818"></a><a name="zh-cn_topic_0160619034_p6290132135818"></a>"instance_count": 1</p>
<p id="zh-cn_topic_0160619034_p13290163245810"><a name="zh-cn_topic_0160619034_p13290163245810"></a><a name="zh-cn_topic_0160619034_p13290163245810"></a>}</p>
<p id="zh-cn_topic_0160619034_p18290163225816"><a name="zh-cn_topic_0160619034_p18290163225816"></a><a name="zh-cn_topic_0160619034_p18290163225816"></a>]</p>
<p id="zh-cn_topic_0160619034_p14290932155817"><a name="zh-cn_topic_0160619034_p14290932155817"></a><a name="zh-cn_topic_0160619034_p14290932155817"></a>}</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row1687613842514"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1187828182513"><a name="zh-cn_topic_0160619034_p1187828182513"></a><a name="zh-cn_topic_0160619034_p1187828182513"></a>specification</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p38801282251"><a name="zh-cn_topic_0160619034_p38801282251"></a><a name="zh-cn_topic_0160619034_p38801282251"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p08821882254"><a name="zh-cn_topic_0160619034_p08821882254"></a><a name="zh-cn_topic_0160619034_p08821882254"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p152111045125813"><a name="zh-cn_topic_0160619034_p152111045125813"></a><a name="zh-cn_topic_0160619034_p152111045125813"></a>资源规格，当前版本可选modelarts.vm.cpu.2u/modelarts.vm.gpu.p4(需申请)/modelarts.vm.ai1.a310(需申请)，需申请权限才能使用的规格请在华为云创建工单，由ModelArts运维工程师添加权限。当取值为“local”时，即为在本地推理，请参见<a href="部署本地服务.md#zh-cn_topic_0160619034_table37462542238">部署本地Predictor说明</a>。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row988558102512"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1588814812519"><a name="zh-cn_topic_0160619034_p1588814812519"></a><a name="zh-cn_topic_0160619034_p1588814812519"></a>instance_count</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p68902872512"><a name="zh-cn_topic_0160619034_p68902872512"></a><a name="zh-cn_topic_0160619034_p68902872512"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p18926812256"><a name="zh-cn_topic_0160619034_p18926812256"></a><a name="zh-cn_topic_0160619034_p18926812256"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1253075612589"><a name="zh-cn_topic_0160619034_p1253075612589"></a><a name="zh-cn_topic_0160619034_p1253075612589"></a>模型部署的实例数，当前限制最大实例数为5，如需使用更多的实例数，需提交工单申请。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row208952088256"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p48972820252"><a name="zh-cn_topic_0160619034_p48972820252"></a><a name="zh-cn_topic_0160619034_p48972820252"></a>envs</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1889910820252"><a name="zh-cn_topic_0160619034_p1889910820252"></a><a name="zh-cn_topic_0160619034_p1889910820252"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p119011483251"><a name="zh-cn_topic_0160619034_p119011483251"></a><a name="zh-cn_topic_0160619034_p119011483251"></a>Map&lt;String, String&gt;</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p590416818251"><a name="zh-cn_topic_0160619034_p590416818251"></a><a name="zh-cn_topic_0160619034_p590416818251"></a>运行模型需要的环境变量键值对，可选填，默认为空。</p>
</td>
</tr>
</tbody>
</table>

**表 4**  transformer configs结构

<a name="zh-cn_topic_0160619034_table6420928063"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row12420102810614"><th class="cellrowborder" valign="top" width="12.574257425742575%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p164282280612"><a name="zh-cn_topic_0160619034_p164282280612"></a><a name="zh-cn_topic_0160619034_p164282280612"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="6.702970297029702%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p1442892817613"><a name="zh-cn_topic_0160619034_p1442892817613"></a><a name="zh-cn_topic_0160619034_p1442892817613"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="15.396039603960396%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p942814289610"><a name="zh-cn_topic_0160619034_p942814289610"></a><a name="zh-cn_topic_0160619034_p942814289610"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="65.32673267326733%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p342819281067"><a name="zh-cn_topic_0160619034_p342819281067"></a><a name="zh-cn_topic_0160619034_p342819281067"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row242862813615"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1042811281364"><a name="zh-cn_topic_0160619034_p1042811281364"></a><a name="zh-cn_topic_0160619034_p1042811281364"></a>model_id</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1343542810611"><a name="zh-cn_topic_0160619034_p1343542810611"></a><a name="zh-cn_topic_0160619034_p1343542810611"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p643515281612"><a name="zh-cn_topic_0160619034_p643515281612"></a><a name="zh-cn_topic_0160619034_p643515281612"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p144351289614"><a name="zh-cn_topic_0160619034_p144351289614"></a><a name="zh-cn_topic_0160619034_p144351289614"></a>模型ID。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row644311283615"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1444316281614"><a name="zh-cn_topic_0160619034_p1444316281614"></a><a name="zh-cn_topic_0160619034_p1444316281614"></a>specification</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1745022815613"><a name="zh-cn_topic_0160619034_p1745022815613"></a><a name="zh-cn_topic_0160619034_p1745022815613"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p124501281565"><a name="zh-cn_topic_0160619034_p124501281565"></a><a name="zh-cn_topic_0160619034_p124501281565"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1192195463517"><a name="zh-cn_topic_0160619034_p1192195463517"></a><a name="zh-cn_topic_0160619034_p1192195463517"></a>资源规格，当前版本可选modelarts.vm.cpu.2u/modelarts.vm.gpu.p4。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row104508285618"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p645020286620"><a name="zh-cn_topic_0160619034_p645020286620"></a><a name="zh-cn_topic_0160619034_p645020286620"></a>instance_count</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p104501028868"><a name="zh-cn_topic_0160619034_p104501028868"></a><a name="zh-cn_topic_0160619034_p104501028868"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p545910281362"><a name="zh-cn_topic_0160619034_p545910281362"></a><a name="zh-cn_topic_0160619034_p545910281362"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1745912811612"><a name="zh-cn_topic_0160619034_p1745912811612"></a><a name="zh-cn_topic_0160619034_p1745912811612"></a>模型部署的实例数，邀测阶段取值范围[1, 2]。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row245911284618"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p174598287617"><a name="zh-cn_topic_0160619034_p174598287617"></a><a name="zh-cn_topic_0160619034_p174598287617"></a>envs</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p194590281468"><a name="zh-cn_topic_0160619034_p194590281468"></a><a name="zh-cn_topic_0160619034_p194590281468"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p204591928064"><a name="zh-cn_topic_0160619034_p204591928064"></a><a name="zh-cn_topic_0160619034_p204591928064"></a>Map&lt;String, String&gt;</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p14459202819615"><a name="zh-cn_topic_0160619034_p14459202819615"></a><a name="zh-cn_topic_0160619034_p14459202819615"></a>运行模型需要的环境变量键值对，可选填，默认为空。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row27917187920"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p27919181917"><a name="zh-cn_topic_0160619034_p27919181917"></a><a name="zh-cn_topic_0160619034_p27919181917"></a>src_path</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p37921815919"><a name="zh-cn_topic_0160619034_p37921815919"></a><a name="zh-cn_topic_0160619034_p37921815919"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p2791818799"><a name="zh-cn_topic_0160619034_p2791818799"></a><a name="zh-cn_topic_0160619034_p2791818799"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p137911181899"><a name="zh-cn_topic_0160619034_p137911181899"></a><a name="zh-cn_topic_0160619034_p137911181899"></a>批量任务输入数据的OBS路径。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row924312220920"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p13250162218914"><a name="zh-cn_topic_0160619034_p13250162218914"></a><a name="zh-cn_topic_0160619034_p13250162218914"></a>dest_path</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p152505229917"><a name="zh-cn_topic_0160619034_p152505229917"></a><a name="zh-cn_topic_0160619034_p152505229917"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p122507220919"><a name="zh-cn_topic_0160619034_p122507220919"></a><a name="zh-cn_topic_0160619034_p122507220919"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p647112917104"><a name="zh-cn_topic_0160619034_p647112917104"></a><a name="zh-cn_topic_0160619034_p647112917104"></a>批量任务输出结果的OBS路径。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row62328563176"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1823215618175"><a name="zh-cn_topic_0160619034_p1823215618175"></a><a name="zh-cn_topic_0160619034_p1823215618175"></a>req_uri</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p16234125681718"><a name="zh-cn_topic_0160619034_p16234125681718"></a><a name="zh-cn_topic_0160619034_p16234125681718"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p18234205618176"><a name="zh-cn_topic_0160619034_p18234205618176"></a><a name="zh-cn_topic_0160619034_p18234205618176"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p15991750134316"><a name="zh-cn_topic_0160619034_p15991750134316"></a><a name="zh-cn_topic_0160619034_p15991750134316"></a>批量任务中调用的推理接口，即模型镜像中暴露的REST接口，需要从模型的config.json文件中选取一个api路径用于此次推理；如使用ModelArts提供的预置推理镜像，则此接口为/</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row285695891717"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1085645820173"><a name="zh-cn_topic_0160619034_p1085645820173"></a><a name="zh-cn_topic_0160619034_p1085645820173"></a>mapping_type</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p18856115816179"><a name="zh-cn_topic_0160619034_p18856115816179"></a><a name="zh-cn_topic_0160619034_p18856115816179"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p585614581175"><a name="zh-cn_topic_0160619034_p585614581175"></a><a name="zh-cn_topic_0160619034_p585614581175"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="p18859132072910"><a name="p18859132072910"></a><a name="p18859132072910"></a>输入数据的映射类型，可选<span class="parmvalue" id="parmvalue3107174115293"><a name="parmvalue3107174115293"></a><a name="parmvalue3107174115293"></a>“file”</span>或<span class="parmvalue" id="parmvalue7765164314294"><a name="parmvalue7765164314294"></a><a name="parmvalue7765164314294"></a>“csv”</span>。</p>
<a name="ul9992152211292"></a><a name="ul9992152211292"></a><ul id="ul9992152211292"><li>file指每个推理请求对应到输入数据目录下的一个文件，当使用此方式时，此模型对应req_uri只能有一个输入参数且此参数的类型是file。</li><li>csv指每个推理请求对应到csv里的一行数据，当使用此方式时，输入数据目录下的文件只能以.csv为后缀，且需配置mapping_rule参数，以表达推理请求体中各个参数对应到csv的索引。</li></ul>
<p id="zh-cn_topic_0160619034_p1567374319574"><a name="zh-cn_topic_0160619034_p1567374319574"></a><a name="zh-cn_topic_0160619034_p1567374319574"></a>创建批量服务且输入数据映射方式为file的样例</p>
<p id="zh-cn_topic_0160619034_p176731043205715"><a name="zh-cn_topic_0160619034_p176731043205715"></a><a name="zh-cn_topic_0160619034_p176731043205715"></a>{</p>
<p id="zh-cn_topic_0160619034_p967318437577"><a name="zh-cn_topic_0160619034_p967318437577"></a><a name="zh-cn_topic_0160619034_p967318437577"></a>"service_name": "batchservicetest",</p>
<p id="zh-cn_topic_0160619034_p46731043115719"><a name="zh-cn_topic_0160619034_p46731043115719"></a><a name="zh-cn_topic_0160619034_p46731043115719"></a>"description": "",</p>
<p id="zh-cn_topic_0160619034_p1367304315710"><a name="zh-cn_topic_0160619034_p1367304315710"></a><a name="zh-cn_topic_0160619034_p1367304315710"></a>"infer_type": "batch",</p>
<p id="zh-cn_topic_0160619034_p14673114385719"><a name="zh-cn_topic_0160619034_p14673114385719"></a><a name="zh-cn_topic_0160619034_p14673114385719"></a>"config": [{</p>
<p id="zh-cn_topic_0160619034_p1267354315714"><a name="zh-cn_topic_0160619034_p1267354315714"></a><a name="zh-cn_topic_0160619034_p1267354315714"></a>"model_id": "598b913a-af3e-41ba-a1b5-bf065320f1e2",</p>
<p id="zh-cn_topic_0160619034_p367313433578"><a name="zh-cn_topic_0160619034_p367313433578"></a><a name="zh-cn_topic_0160619034_p367313433578"></a>"specification": "modelarts.vm.cpu.2u",</p>
<p id="zh-cn_topic_0160619034_p1167314325712"><a name="zh-cn_topic_0160619034_p1167314325712"></a><a name="zh-cn_topic_0160619034_p1167314325712"></a>"instance_count": 1,</p>
<p id="zh-cn_topic_0160619034_p1767318431578"><a name="zh-cn_topic_0160619034_p1767318431578"></a><a name="zh-cn_topic_0160619034_p1767318431578"></a>"src_path": "https://infers-data.obs.myhwclouds.com/xgboosterdata/",</p>
<p id="zh-cn_topic_0160619034_p46735439570"><a name="zh-cn_topic_0160619034_p46735439570"></a><a name="zh-cn_topic_0160619034_p46735439570"></a>"dest_path": "https://infers-data.obs.myhwclouds.com/output/",</p>
<p id="zh-cn_topic_0160619034_p196731043125718"><a name="zh-cn_topic_0160619034_p196731043125718"></a><a name="zh-cn_topic_0160619034_p196731043125718"></a>"req_uri": "/",</p>
<p id="zh-cn_topic_0160619034_p13673143185716"><a name="zh-cn_topic_0160619034_p13673143185716"></a><a name="zh-cn_topic_0160619034_p13673143185716"></a>"mapping_type": "file"</p>
<p id="zh-cn_topic_0160619034_p186734431579"><a name="zh-cn_topic_0160619034_p186734431579"></a><a name="zh-cn_topic_0160619034_p186734431579"></a>}]</p>
<p id="zh-cn_topic_0160619034_p2067314318572"><a name="zh-cn_topic_0160619034_p2067314318572"></a><a name="zh-cn_topic_0160619034_p2067314318572"></a>}</p>
<p id="zh-cn_topic_0160619034_p17786115845719"><a name="zh-cn_topic_0160619034_p17786115845719"></a><a name="zh-cn_topic_0160619034_p17786115845719"></a>创建批量服务且输入数据映射方式为csv的样例</p>
<p id="zh-cn_topic_0160619034_p778612585571"><a name="zh-cn_topic_0160619034_p778612585571"></a><a name="zh-cn_topic_0160619034_p778612585571"></a>{</p>
<p id="zh-cn_topic_0160619034_p127861458125714"><a name="zh-cn_topic_0160619034_p127861458125714"></a><a name="zh-cn_topic_0160619034_p127861458125714"></a>"service_name": "batchservicetest",</p>
<p id="zh-cn_topic_0160619034_p197861158165710"><a name="zh-cn_topic_0160619034_p197861158165710"></a><a name="zh-cn_topic_0160619034_p197861158165710"></a>"description": "",</p>
<p id="zh-cn_topic_0160619034_p1478695875711"><a name="zh-cn_topic_0160619034_p1478695875711"></a><a name="zh-cn_topic_0160619034_p1478695875711"></a>"infer_type": "batch",</p>
<p id="zh-cn_topic_0160619034_p15786125805719"><a name="zh-cn_topic_0160619034_p15786125805719"></a><a name="zh-cn_topic_0160619034_p15786125805719"></a>"config": [{</p>
<p id="zh-cn_topic_0160619034_p12786105810576"><a name="zh-cn_topic_0160619034_p12786105810576"></a><a name="zh-cn_topic_0160619034_p12786105810576"></a>"model_id": "598b913a-af3e-41ba-a1b5-bf065320f1e2",</p>
<p id="zh-cn_topic_0160619034_p1786105814577"><a name="zh-cn_topic_0160619034_p1786105814577"></a><a name="zh-cn_topic_0160619034_p1786105814577"></a>"specification": "modelarts.vm.cpu.2u",</p>
<p id="zh-cn_topic_0160619034_p19786135825716"><a name="zh-cn_topic_0160619034_p19786135825716"></a><a name="zh-cn_topic_0160619034_p19786135825716"></a>"instance_count": 1,</p>
<p id="zh-cn_topic_0160619034_p978695845720"><a name="zh-cn_topic_0160619034_p978695845720"></a><a name="zh-cn_topic_0160619034_p978695845720"></a>"src_path": "https://infers-data.obs.myhwclouds.com/xgboosterdata/",</p>
<p id="zh-cn_topic_0160619034_p178625817573"><a name="zh-cn_topic_0160619034_p178625817573"></a><a name="zh-cn_topic_0160619034_p178625817573"></a>"dest_path": "https://infers-data.obs.myhwclouds.com/output/",</p>
<p id="zh-cn_topic_0160619034_p978610581577"><a name="zh-cn_topic_0160619034_p978610581577"></a><a name="zh-cn_topic_0160619034_p978610581577"></a>"req_uri": "/",</p>
<p id="zh-cn_topic_0160619034_p177864581571"><a name="zh-cn_topic_0160619034_p177864581571"></a><a name="zh-cn_topic_0160619034_p177864581571"></a>"mapping_type": "csv",</p>
<p id="zh-cn_topic_0160619034_p678635845713"><a name="zh-cn_topic_0160619034_p678635845713"></a><a name="zh-cn_topic_0160619034_p678635845713"></a>"mapping_rule": {</p>
<p id="zh-cn_topic_0160619034_p2078616585574"><a name="zh-cn_topic_0160619034_p2078616585574"></a><a name="zh-cn_topic_0160619034_p2078616585574"></a>"type": "object",</p>
<p id="zh-cn_topic_0160619034_p778665814575"><a name="zh-cn_topic_0160619034_p778665814575"></a><a name="zh-cn_topic_0160619034_p778665814575"></a>"properties": {</p>
<p id="zh-cn_topic_0160619034_p11786758195713"><a name="zh-cn_topic_0160619034_p11786758195713"></a><a name="zh-cn_topic_0160619034_p11786758195713"></a>"data": {</p>
<p id="zh-cn_topic_0160619034_p0786258175718"><a name="zh-cn_topic_0160619034_p0786258175718"></a><a name="zh-cn_topic_0160619034_p0786258175718"></a>"type": "object",</p>
<p id="zh-cn_topic_0160619034_p8786155818577"><a name="zh-cn_topic_0160619034_p8786155818577"></a><a name="zh-cn_topic_0160619034_p8786155818577"></a>"properties": {</p>
<p id="zh-cn_topic_0160619034_p97861588572"><a name="zh-cn_topic_0160619034_p97861588572"></a><a name="zh-cn_topic_0160619034_p97861588572"></a>"req_data": {</p>
<p id="zh-cn_topic_0160619034_p187861158135720"><a name="zh-cn_topic_0160619034_p187861158135720"></a><a name="zh-cn_topic_0160619034_p187861158135720"></a>"type": "array",</p>
<p id="zh-cn_topic_0160619034_p157861589571"><a name="zh-cn_topic_0160619034_p157861589571"></a><a name="zh-cn_topic_0160619034_p157861589571"></a>"items": [{</p>
<p id="zh-cn_topic_0160619034_p6786958125713"><a name="zh-cn_topic_0160619034_p6786958125713"></a><a name="zh-cn_topic_0160619034_p6786958125713"></a>"type": "object",</p>
<p id="zh-cn_topic_0160619034_p1478617584573"><a name="zh-cn_topic_0160619034_p1478617584573"></a><a name="zh-cn_topic_0160619034_p1478617584573"></a>"properties": {</p>
<p id="zh-cn_topic_0160619034_p10786358195718"><a name="zh-cn_topic_0160619034_p10786358195718"></a><a name="zh-cn_topic_0160619034_p10786358195718"></a>"input5": {</p>
<p id="zh-cn_topic_0160619034_p19786135885716"><a name="zh-cn_topic_0160619034_p19786135885716"></a><a name="zh-cn_topic_0160619034_p19786135885716"></a>"type": "number",</p>
<p id="zh-cn_topic_0160619034_p187863585577"><a name="zh-cn_topic_0160619034_p187863585577"></a><a name="zh-cn_topic_0160619034_p187863585577"></a>"index": 0</p>
<p id="zh-cn_topic_0160619034_p0786205885720"><a name="zh-cn_topic_0160619034_p0786205885720"></a><a name="zh-cn_topic_0160619034_p0786205885720"></a>},</p>
<p id="zh-cn_topic_0160619034_p978685816576"><a name="zh-cn_topic_0160619034_p978685816576"></a><a name="zh-cn_topic_0160619034_p978685816576"></a>"input4": {</p>
<p id="zh-cn_topic_0160619034_p678775835716"><a name="zh-cn_topic_0160619034_p678775835716"></a><a name="zh-cn_topic_0160619034_p678775835716"></a>"type": "number",</p>
<p id="zh-cn_topic_0160619034_p778735885712"><a name="zh-cn_topic_0160619034_p778735885712"></a><a name="zh-cn_topic_0160619034_p778735885712"></a>"index": 1</p>
<p id="zh-cn_topic_0160619034_p47871958105715"><a name="zh-cn_topic_0160619034_p47871958105715"></a><a name="zh-cn_topic_0160619034_p47871958105715"></a>},</p>
<p id="zh-cn_topic_0160619034_p1978755813572"><a name="zh-cn_topic_0160619034_p1978755813572"></a><a name="zh-cn_topic_0160619034_p1978755813572"></a>"input3": {</p>
<p id="zh-cn_topic_0160619034_p8787458155717"><a name="zh-cn_topic_0160619034_p8787458155717"></a><a name="zh-cn_topic_0160619034_p8787458155717"></a>"type": "number",</p>
<p id="zh-cn_topic_0160619034_p478725818574"><a name="zh-cn_topic_0160619034_p478725818574"></a><a name="zh-cn_topic_0160619034_p478725818574"></a>"index": 2</p>
<p id="zh-cn_topic_0160619034_p0787125855716"><a name="zh-cn_topic_0160619034_p0787125855716"></a><a name="zh-cn_topic_0160619034_p0787125855716"></a>},</p>
<p id="zh-cn_topic_0160619034_p207871358125711"><a name="zh-cn_topic_0160619034_p207871358125711"></a><a name="zh-cn_topic_0160619034_p207871358125711"></a>"input2": {</p>
<p id="zh-cn_topic_0160619034_p978711582572"><a name="zh-cn_topic_0160619034_p978711582572"></a><a name="zh-cn_topic_0160619034_p978711582572"></a>"type": "number",</p>
<p id="zh-cn_topic_0160619034_p14787205875715"><a name="zh-cn_topic_0160619034_p14787205875715"></a><a name="zh-cn_topic_0160619034_p14787205875715"></a>"index": 3</p>
<p id="zh-cn_topic_0160619034_p2787125855710"><a name="zh-cn_topic_0160619034_p2787125855710"></a><a name="zh-cn_topic_0160619034_p2787125855710"></a>},</p>
<p id="zh-cn_topic_0160619034_p197871258155710"><a name="zh-cn_topic_0160619034_p197871258155710"></a><a name="zh-cn_topic_0160619034_p197871258155710"></a>"input1": {</p>
<p id="zh-cn_topic_0160619034_p107874584573"><a name="zh-cn_topic_0160619034_p107874584573"></a><a name="zh-cn_topic_0160619034_p107874584573"></a>"type": "number",</p>
<p id="zh-cn_topic_0160619034_p10787155835715"><a name="zh-cn_topic_0160619034_p10787155835715"></a><a name="zh-cn_topic_0160619034_p10787155835715"></a>"index": 4</p>
<p id="zh-cn_topic_0160619034_p378715895714"><a name="zh-cn_topic_0160619034_p378715895714"></a><a name="zh-cn_topic_0160619034_p378715895714"></a>}</p>
<p id="zh-cn_topic_0160619034_p57871358135713"><a name="zh-cn_topic_0160619034_p57871358135713"></a><a name="zh-cn_topic_0160619034_p57871358135713"></a>}</p>
<p id="zh-cn_topic_0160619034_p19787115875715"><a name="zh-cn_topic_0160619034_p19787115875715"></a><a name="zh-cn_topic_0160619034_p19787115875715"></a>}]</p>
<p id="zh-cn_topic_0160619034_p18787125835719"><a name="zh-cn_topic_0160619034_p18787125835719"></a><a name="zh-cn_topic_0160619034_p18787125835719"></a>}</p>
<p id="zh-cn_topic_0160619034_p19787125810575"><a name="zh-cn_topic_0160619034_p19787125810575"></a><a name="zh-cn_topic_0160619034_p19787125810575"></a>}</p>
<p id="zh-cn_topic_0160619034_p1478755819575"><a name="zh-cn_topic_0160619034_p1478755819575"></a><a name="zh-cn_topic_0160619034_p1478755819575"></a>}</p>
<p id="zh-cn_topic_0160619034_p27878583578"><a name="zh-cn_topic_0160619034_p27878583578"></a><a name="zh-cn_topic_0160619034_p27878583578"></a>}</p>
<p id="zh-cn_topic_0160619034_p127873582577"><a name="zh-cn_topic_0160619034_p127873582577"></a><a name="zh-cn_topic_0160619034_p127873582577"></a>}</p>
<p id="zh-cn_topic_0160619034_p178718581579"><a name="zh-cn_topic_0160619034_p178718581579"></a><a name="zh-cn_topic_0160619034_p178718581579"></a>}]</p>
<p id="zh-cn_topic_0160619034_p278719581579"><a name="zh-cn_topic_0160619034_p278719581579"></a><a name="zh-cn_topic_0160619034_p278719581579"></a>}</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row158141118183"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p481416131817"><a name="zh-cn_topic_0160619034_p481416131817"></a><a name="zh-cn_topic_0160619034_p481416131817"></a>mapping_rule</p>
</td>
<td class="cellrowborder" valign="top" width="6.702970297029702%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p188141813180"><a name="zh-cn_topic_0160619034_p188141813180"></a><a name="zh-cn_topic_0160619034_p188141813180"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="15.396039603960396%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p178147119189"><a name="zh-cn_topic_0160619034_p178147119189"></a><a name="zh-cn_topic_0160619034_p178147119189"></a>Map</p>
</td>
<td class="cellrowborder" valign="top" width="65.32673267326733%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p12814018180"><a name="zh-cn_topic_0160619034_p12814018180"></a><a name="zh-cn_topic_0160619034_p12814018180"></a>输入参数与csv数据的映射关系，仅当mapping_type为csv时需要填写。映射规则与模型配置文件config.json中输入参数的定义方式相似，只需要在每一个基本类型（string/number/integer/boolean）的参数下配置index参数，指定使用csv数据中对应索引下标的数据作为此参数的值去发送推理请求，csv数据必须以英文半角逗号分隔，index从0开始计数，特殊地，当index为-1时忽略此参数，具体请参见<a href="#zh-cn_topic_0160619034_li10567114011171">部署transformer的示例代码</a>的样例。</p>
<p id="zh-cn_topic_0160619034_p16246141718588"><a name="zh-cn_topic_0160619034_p16246141718588"></a><a name="zh-cn_topic_0160619034_p16246141718588"></a>样例中mapping_rule描述的推理请求体格式为：</p>
<p id="zh-cn_topic_0160619034_p42461517145818"><a name="zh-cn_topic_0160619034_p42461517145818"></a><a name="zh-cn_topic_0160619034_p42461517145818"></a>{</p>
<p id="zh-cn_topic_0160619034_p224619179589"><a name="zh-cn_topic_0160619034_p224619179589"></a><a name="zh-cn_topic_0160619034_p224619179589"></a>"data": {</p>
<p id="zh-cn_topic_0160619034_p192461617105820"><a name="zh-cn_topic_0160619034_p192461617105820"></a><a name="zh-cn_topic_0160619034_p192461617105820"></a>"req_data": [{</p>
<p id="zh-cn_topic_0160619034_p1424651713580"><a name="zh-cn_topic_0160619034_p1424651713580"></a><a name="zh-cn_topic_0160619034_p1424651713580"></a>"input1": 1,</p>
<p id="zh-cn_topic_0160619034_p724612172581"><a name="zh-cn_topic_0160619034_p724612172581"></a><a name="zh-cn_topic_0160619034_p724612172581"></a>"input2": 2,</p>
<p id="zh-cn_topic_0160619034_p624615171583"><a name="zh-cn_topic_0160619034_p624615171583"></a><a name="zh-cn_topic_0160619034_p624615171583"></a>"input3": 3,</p>
<p id="zh-cn_topic_0160619034_p2246201719588"><a name="zh-cn_topic_0160619034_p2246201719588"></a><a name="zh-cn_topic_0160619034_p2246201719588"></a>"input4": 4,</p>
<p id="zh-cn_topic_0160619034_p1224671725818"><a name="zh-cn_topic_0160619034_p1224671725818"></a><a name="zh-cn_topic_0160619034_p1224671725818"></a>"input5": 5</p>
<p id="zh-cn_topic_0160619034_p624681715811"><a name="zh-cn_topic_0160619034_p624681715811"></a><a name="zh-cn_topic_0160619034_p624681715811"></a>}]</p>
<p id="zh-cn_topic_0160619034_p224691714581"><a name="zh-cn_topic_0160619034_p224691714581"></a><a name="zh-cn_topic_0160619034_p224691714581"></a>}</p>
<p id="zh-cn_topic_0160619034_p7246917125816"><a name="zh-cn_topic_0160619034_p7246917125816"></a><a name="zh-cn_topic_0160619034_p7246917125816"></a>}</p>
</td>
</tr>
</tbody>
</table>

**表 5**  部署predictor和transformer返回参数说明

<a name="zh-cn_topic_0160619034_table19248816291"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row092468182915"><th class="cellrowborder" valign="top" width="12.659999999999998%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p119241181292"><a name="zh-cn_topic_0160619034_p119241181292"></a><a name="zh-cn_topic_0160619034_p119241181292"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="7.13%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p189248810294"><a name="zh-cn_topic_0160619034_p189248810294"></a><a name="zh-cn_topic_0160619034_p189248810294"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="15.22%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p39246812913"><a name="zh-cn_topic_0160619034_p39246812913"></a><a name="zh-cn_topic_0160619034_p39246812913"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="64.99000000000001%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p16924148142918"><a name="zh-cn_topic_0160619034_p16924148142918"></a><a name="zh-cn_topic_0160619034_p16924148142918"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row1392418102915"><td class="cellrowborder" valign="top" width="12.659999999999998%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1892488192918"><a name="zh-cn_topic_0160619034_p1892488192918"></a><a name="zh-cn_topic_0160619034_p1892488192918"></a>predictor</p>
</td>
<td class="cellrowborder" valign="top" width="7.13%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p492438142911"><a name="zh-cn_topic_0160619034_p492438142911"></a><a name="zh-cn_topic_0160619034_p492438142911"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.22%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p11924108162919"><a name="zh-cn_topic_0160619034_p11924108162919"></a><a name="zh-cn_topic_0160619034_p11924108162919"></a>Predictor对象</p>
</td>
<td class="cellrowborder" valign="top" width="64.99000000000001%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p19924118192917"><a name="zh-cn_topic_0160619034_p19924118192917"></a><a name="zh-cn_topic_0160619034_p19924118192917"></a>Predictor对象，其属性描述包括服务管理章节全部功能。</p>
</td>
</tr>
</tbody>
</table>

>![](public_sys-resources/icon-note.gif) **说明：**   
>-   **给出MXNet实现手写数字识别项目中部署在线predictror实例：**  
>    ```  
>    from modelarts.session import Session  
>    from modelarts.model import Model  
>    from modelarts.config.model_config import ServiceConfig,TransformerConfig   
>    model_instance = Model(session, model_id = "input you model id")  
>    configs = []  
>    config1 = ServiceConfig(model_id="input you model id",   
>                            weight="100",   
>                            instance_count=1,   
>                            specification="modelarts.vm.cpu.2u",  
>                            envs={"input_data_name":"images",  
>                                  "input_data_shape":"0,1,28,28",  
>                                  "output_data_shape":"0,10"})  
>    configs.append(config1)  
>    predictor = model_instance.deploy_predictor(service_name="DigitRecognition", configs=configs)  
>    ```  
>-   **给出MXNet实现手写数字识别项目中部署transformer实例（批推理）：**  
>    ```  
>    from modelarts.session import Session  
>    from modelarts.model import Model  
>    from modelarts.config.model_config import ServiceConfig,TransformerConfig  
>    model_instance = Model(session, model_id = "input your model id")   
>    configs = []  
>    config1 = TransformerConfig(model_id="input your model id",   
>                                specification="modelarts.vm.cpu.2u",   
>                                instance_count=1,   
>                                envs={"input_data_name":"images","input_data_shape":"0,1,28,28","output_data_shape":"0,10"},  
>                                src_path="/wangjianfeng0403/testdigitrecognition/inferimages/",  
>                                dest_path="/wangjianfeng0403/testdigitrecognition/" ,  
>                                req_uri = "/",  
>                                mapping_type = "file")  
>    configs.append(config1)  
>    predictor = model_instance.deploy_transformer(service_name="DigitRecognition", infer_type="batch", configs=configs)  
>    ```  

